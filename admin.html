// 🏆 대시보드 누적 출석 랭킹 렌더링 (정확한 날짜 포맷팅 버전)
function renderRanking() {
    const rankListEl = document.getElementById('rankList');
    if(!rankListEl) return;

    // 현재 월의 마지막 날 계산
    const lastDay = new Date(currentYear, currentMonth, 0).getDate();
    let scores = [];

    // 참가자별 이번 달 출석 횟수 계산
    Object.entries(participants).forEach(([uid, p]) => {
        let count = 0;
        // 1일부터 오늘(또는 말일)까지 반복하며 실제 체크인 데이터 확인
        for(let i = 1; i <= lastDay; i++) {
            // Firebase 저장 방식인 YYYY-MM-DD 형식으로 정확히 매칭
            const yearStr = currentYear;
            const monthStr = String(currentMonth).padStart(2, '0');
            const dayStr = String(i).padStart(2, '0');
            const dKey = `${yearStr}-${monthStr}-${dayStr}`;
            
            // 해당 날짜에 해당 유저의 체크인 기록이 있는지 확인
            if(allCheckins[dKey] && allCheckins[dKey][uid]) {
                count++;
            }
        }
        scores.push({ name: p.name, count: count, uid: uid });
    });

    // 1. 출석 횟수 내림차순 2. 이름 순으로 정렬
    scores.sort((a, b) => {
        if (b.count !== a.count) return b.count - a.count;
        return a.name.localeCompare(b.name);
    });

    let html = "";
    scores.forEach((s, idx) => {
        // 순위별 강조 스타일 적용 가능
        const rankColor = idx < 3 ? "#667eea" : "#555";
        html += `
            <div class="ranking-item" style="border-left: 4px solid ${rankColor}">
                <span><b style="color:${rankColor}">${idx + 1}위</b> ${s.name} (${s.uid}번)</span>
                <b>${s.count}회 성공</b>
            </div>`;
    });
    
    rankListEl.innerHTML = html || "출석 데이터가 없습니다.";
}
